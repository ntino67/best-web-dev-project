USE test_web_k;

CREATE TABLE `Roles` (
  `id_role` INTEGER PRIMARY KEY,
  `name` VARCHAR(255)
);

CREATE TABLE `Class` (
  `id_class` INTEGER PRIMARY KEY,
  `class_year` INTEGER
);

CREATE TABLE `Centers` (
  `id_center` INT PRIMARY KEY,
  `center_name` VARCHAR(255)
);

CREATE TABLE `Country` (
  `id_country` INT PRIMARY KEY,
  `name` VARCHAR(255)
);

CREATE TABLE `Cities` (
  `id_city` INT PRIMARY KEY,
  `id_country` INT,
  `name` VARCHAR(255),
  `postal_code` INT,
  CONSTRAINT `city_is_in_country` FOREIGN KEY (`id_country`) REFERENCES `Country` (`id_country`)
);

CREATE TABLE `Companies` (
  `id_company` INT PRIMARY KEY,
  `id_city` INT,
  `company_name` VARCHAR(255),
  CONSTRAINT `company_is_in_city` FOREIGN KEY (`id_city`) REFERENCES `Cities` (`id_city`)
);

CREATE TABLE `Skills` (
  `id_skill` INT PRIMARY KEY,
  `skill_name` VARCHAR(255)
);

CREATE TABLE `Users` (
  `id_user` INTEGER PRIMARY KEY,
  `id_class` INTEGER,
  `first_name` VARCHAR(255),
  `last_name` VARCHAR(255),
  `password` VARCHAR(255),
  `created_at` TIMESTAMP,
  `id_center` INTEGER,
  `id_role` INTEGER,
  CONSTRAINT `user_has_role` FOREIGN KEY (`id_role`) REFERENCES `Roles` (`id_role`),
  CONSTRAINT `user_is_in_center` FOREIGN KEY (`id_center`) REFERENCES `Centers` (`id_center`)
);

ALTER TABLE `Users` ADD INDEX `idx_id_class` (`id_class`);

CREATE TABLE `Users_Class` (
  `Users_id_class` INTEGER,
  `Class_id_class` INTEGER,
  PRIMARY KEY (`Users_id_class`, `Class_id_class`),
  FOREIGN KEY (`Users_id_class`) REFERENCES `Users` (`id_user`),
  FOREIGN KEY (`Class_id_class`) REFERENCES `Class` (`id_class`)
);

CREATE TABLE `Internship_offers` (
  `id_internship_offer` INT PRIMARY KEY,
  `id_company` INT,
  `available_slots` INT,
  `created_at` DATE,
  `expires_at` DATE,
  CONSTRAINT `offer_belongs_to_company` FOREIGN KEY (`id_company`) REFERENCES `Companies` (`id_company`)
);

CREATE TABLE `Internship_offers_Skills` (
  `Internship_offers_id_internship_offer` INT,
  `Skills_id_skill` INT,
  PRIMARY KEY (`Internship_offers_id_internship_offer`, `Skills_id_skill`),
  FOREIGN KEY (`Internship_offers_id_internship_offer`) REFERENCES `Internship_offers` (`id_internship_offer`),
  FOREIGN KEY (`Skills_id_skill`) REFERENCES `Skills` (`id_skill`)
);

CREATE TABLE `Applications` (
  `id_student` INT,
  `id_internship_offer` INT,
  `CV` VARCHAR(255),
  `motivation_letter` VARCHAR(255),
  FOREIGN KEY (`id_internship_offer`) REFERENCES `Internship_offers` (`id_internship_offer`),
  FOREIGN KEY (`id_student`) REFERENCES `Users` (`id_user`)
);

CREATE TABLE `Works_for` (
  `id_student` INT,
  `id_company` INT,
  `start_date` DATE,
  `end_date` DATE,
  FOREIGN KEY (`id_student`) REFERENCES `Users` (`id_user`),
  FOREIGN KEY (`id_company`) REFERENCES `Companies` (`id_company`)
);

CREATE TABLE `Company_Reviews` (
  `id_review` INT PRIMARY KEY,
  `id_company` INT,
  `id_user` INT,
  `review_text` VARCHAR(255),
  FOREIGN KEY (`id_company`) REFERENCES `Companies` (`id_company`),
  FOREIGN KEY (`id_user`) REFERENCES `Users` (`id_user`)
);
