USE web_project;
CREATE TABLE `Roles` (
  `id_role` INTEGER PRIMARY KEY AUTO_INCREMENT,
  `name` VARCHAR(255)
);

CREATE TABLE `Class` (
  `id_class` INTEGER PRIMARY KEY AUTO_INCREMENT,
  `class_year` VARCHAR(255)
);

CREATE TABLE `Centers` (
  `id_center` INT PRIMARY KEY AUTO_INCREMENT,
  `center_name` VARCHAR(255)
);

CREATE TABLE `Country` (
  `id_country` INT PRIMARY KEY AUTO_INCREMENT,
  `name` VARCHAR(255)
);

CREATE TABLE `Cities` (
  `id_city` INT PRIMARY KEY AUTO_INCREMENT,
  `id_country` INT,
  `name` VARCHAR(255),
  `postal_code` VARCHAR(255)
);

CREATE TABLE `Companies` (
  `id_company` INT PRIMARY KEY AUTO_INCREMENT,
  `id_city` INT,
  `company_name` VARCHAR(255),
  `company_description` VARCHAR(1000)
);

CREATE TABLE `Internship_offers` (
  `id_internship_offer` INT PRIMARY KEY AUTO_INCREMENT,
  `id_company` INT,
  `available_slots` INT,
  `title` VARCHAR(255),
  `description` VARCHAR(255),
  `created_at` DATE,
  `expires_at` DATE
);

CREATE TABLE `Skills` (
  `id_skill` INT PRIMARY KEY AUTO_INCREMENT,
  `skill_name` VARCHAR(255)
);

CREATE TABLE `Users` (
  `id_user` INTEGER PRIMARY KEY AUTO_INCREMENT,
  `related_to_class` INTEGER,
  `first_name` VARCHAR(255),
  `last_name` VARCHAR(255),
  `email` VARCHAR(255),
  `password` VARCHAR(255),
  `created_at` TIMESTAMP,
  `id_center` INTEGER,
  `id_role` INTEGER,
  FOREIGN KEY (`related_to_class`) REFERENCES `Class` (`id_class`)
);

CREATE TABLE `Applications` (
  `id_student` INT,
  `id_internship_offer` INT,
  `CV` VARCHAR(255),
  `motivation_letter` VARCHAR(255)
);

CREATE TABLE `Works_for` (
  `id_student` INT,
  `id_company` INT,
  `start_date` DATE,
  `end_date` DATE
);

CREATE TABLE `Company_Reviews` (
  `id_review` INT PRIMARY KEY AUTO_INCREMENT,
  `id_company` INT,
  `id_user` INT,
  `review_text` VARCHAR(255),
  `review_score` INT
);

CREATE TABLE `Required_Skills` (
  `id_internship_offer` INT,
  `required_skills` INT,
  PRIMARY KEY (`id_internship_offer`, `required_skills`),
  FOREIGN KEY (`id_internship_offer`) REFERENCES `Internship_offers` (`id_internship_offer`),
  FOREIGN KEY (`required_skills`) REFERENCES `Skills` (`id_skill`)
);

CREATE TABLE `related_to_class` (
  `id_user` INTEGER,
  `id_class` INTEGER,
  PRIMARY KEY (`id_user`, `id_class`),
  FOREIGN KEY (`id_user`) REFERENCES `Users` (`id_user`),
  FOREIGN KEY (`id_class`) REFERENCES `Class` (`id_class`)
);

ALTER TABLE `Users` ADD CONSTRAINT `user_has_role` FOREIGN KEY (`id_role`) REFERENCES `Roles` (`id_role`);

CREATE INDEX idx_related_to_class ON Users (related_to_class);

ALTER TABLE `Users` ADD CONSTRAINT `user_is_in_center` FOREIGN KEY (`id_center`) REFERENCES `Centers` (`id_center`);

ALTER TABLE `Cities` ADD CONSTRAINT `city_is_in_country` FOREIGN KEY (`id_country`) REFERENCES `Country` (`id_country`);

ALTER TABLE `Companies` ADD CONSTRAINT `company_is_in_city` FOREIGN KEY (`id_city`) REFERENCES `Cities` (`id_city`);

ALTER TABLE `Internship_offers` ADD CONSTRAINT `offer_belongs_to_company` FOREIGN KEY (`id_company`) REFERENCES `Companies` (`id_company`);

ALTER TABLE `Applications` ADD CONSTRAINT `fk_applications_internship_offers` FOREIGN KEY (`id_internship_offer`) REFERENCES `Internship_offers` (`id_internship_offer`);

ALTER TABLE `Applications` ADD CONSTRAINT `fk_applications_students` FOREIGN KEY (`id_student`) REFERENCES `Users` (`id_user`);

ALTER TABLE `Works_for` ADD CONSTRAINT `fk_works_for_students` FOREIGN KEY (`id_student`) REFERENCES `Users` (`id_user`);

ALTER TABLE `Works_for` ADD CONSTRAINT `fk_works_for_companies` FOREIGN KEY (`id_company`) REFERENCES `Companies` (`id_company`);

ALTER TABLE `Company_Reviews` ADD CONSTRAINT `fk_company_reviews_companies` FOREIGN KEY (`id_company`) REFERENCES `Companies` (`id_company`);

ALTER TABLE `Company_Reviews` ADD CONSTRAINT `fk_company_reviews_users` FOREIGN KEY (`id_user`) REFERENCES `Users` (`id_user`);
